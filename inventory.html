<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gudang Pro - Brother Trans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 text-slate-900 min-h-screen pb-20">

    <header class="bg-slate-900 text-white p-4 shadow-xl sticky top-0 z-50">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center space-x-3">
                <div class="bg-yellow-400 p-2 rounded-2xl"><i class="fas fa-boxes text-slate-900 text-xl"></i></div>
                <h1 class="text-xl font-black italic uppercase">Brother <span class="text-yellow-400">Inventory</span></h1>
            </div>
            <div class="flex items-center space-x-2">
                <a href="inventory-detail.html" class="bg-yellow-400 text-slate-900 px-4 py-2.5 rounded-2xl text-[10px] font-black italic shadow-lg">ANALITIK GUDANG</a>
                <a href="index.html" class="bg-slate-800 text-white px-4 py-2.5 rounded-2xl text-[10px] font-bold">Dashboard</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-4 space-y-6">
                <div class="bg-yellow-400 p-8 rounded-[2.5rem] shadow-xl">
                    <h3 class="font-black text-slate-900 text-xs uppercase mb-6 flex items-center"><i class="fas fa-truck-loading mr-2"></i> Update Stok</h3>
                    <form action="/api/parts/restock" method="POST" class="space-y-4">
                        <select name="partId" id="restock-dropdown" required class="w-full px-4 py-3 bg-white/50 border-none rounded-2xl font-bold text-sm outline-none">
                            <option value="">-- Pilih Barang --</option>
                        </select>
                        <div class="grid grid-cols-2 gap-3">
                            <input type="number" name="qty" placeholder="Qty" required class="w-full px-4 py-3 bg-white/50 border-none rounded-2xl font-black outline-none">
                            <input type="number" name="buyPrice" placeholder="Harga Beli" required class="w-full px-4 py-3 bg-white/50 border-none rounded-2xl font-black outline-none">
                        </div>
                        <button type="submit" class="w-full bg-slate-900 text-white font-black py-4 rounded-2xl uppercase text-[10px] tracking-widest shadow-lg">Konfirmasi Masuk</button>
                    </form>
                </div>

                <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-gray-100">
                    <h3 class="font-black text-slate-800 text-xs uppercase mb-6 flex items-center"><i class="fas fa-plus-circle mr-2 text-blue-500"></i> Register Item Baru</h3>
                    <form action="/api/parts/add" method="POST" class="space-y-3">
                        <input type="text" name="name" placeholder="Nama Barang" required class="w-full px-4 py-3 bg-gray-50 border-none rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-400 outline-none">
                        <input type="number" name="price" placeholder="Harga Jual (Rp)" required class="w-full px-4 py-3 bg-gray-50 border-none rounded-xl text-sm font-black text-green-600 focus:ring-2 focus:ring-blue-400 outline-none">
                        <input type="number" name="stock" placeholder="Stok Awal" required class="w-full px-4 py-3 bg-gray-50 border-none rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-400 outline-none">
                        <button type="submit" class="w-full bg-slate-900 text-yellow-400 font-black py-4 rounded-2xl uppercase text-[10px] tracking-widest mt-4">Simpan Barang</button>
                    </form>
                </div>
            </div>

            <div class="lg:col-span-8">
                <div class="bg-white rounded-[2.5rem] shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-8 bg-gray-50/50 border-b border-gray-100 flex justify-between items-center">
                        <h3 class="font-black text-slate-800 text-sm uppercase tracking-widest">Inventory Monitoring</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-400 text-[10px] uppercase font-black tracking-widest">
                                <tr>
                                    <th class="p-6">Barang</th>
                                    <th class="p-6">Harga Jual</th>
                                    <th class="p-6">Stok</th>
                                    <th class="p-6 text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="part-list-body" class="divide-y divide-gray-50">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="editPartModal" class="fixed inset-0 bg-slate-900/90 hidden z-[100] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white rounded-[3rem] p-10 max-w-md w-full shadow-2xl">
            <h3 class="font-black text-xl uppercase mb-8 text-slate-800">Modifikasi <span class="text-blue-500">Item</span></h3>
            <div class="space-y-4">
                <input type="hidden" id="edit-p-id">
                <div>
                    <label class="text-[10px] font-black text-gray-400 uppercase ml-1">Nama Barang</label>
                    <input type="text" id="edit-p-name" class="w-full p-4 bg-gray-50 rounded-2xl font-bold border-none outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                <div>
                    <label class="text-[10px] font-black text-gray-400 uppercase ml-1">Harga Jual (Rp)</label>
                    <input type="number" id="edit-p-price" class="w-full p-4 bg-gray-50 rounded-2xl font-black text-green-600 border-none outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                <div>
                    <label class="text-[10px] font-black text-gray-400 uppercase ml-1">Koreksi Stok</label>
                    <input type="number" id="edit-p-stock" class="w-full p-4 bg-gray-50 rounded-2xl font-black border-none outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                <div class="flex gap-3 pt-6">
                    <button onclick="closeEditModal()" class="flex-1 p-4 bg-gray-100 rounded-2xl font-black text-slate-400 uppercase text-xs">Batal</button>
                    <button onclick="savePartUpdate()" class="flex-1 p-4 bg-slate-900 text-yellow-400 rounded-2xl font-black shadow-xl uppercase text-xs">Update</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const formatR = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);

        async function loadInventory() {
            const res = await fetch('/api/parts');
            const parts = await res.json();
            const tbody = document.getElementById('part-list-body');
            const dropdown = document.getElementById('restock-dropdown');
            
            tbody.innerHTML = '';
            dropdown.innerHTML = '<option value="">-- Pilih Barang --</option>';

            parts.reverse().forEach(p => {
                dropdown.innerHTML += `<option value="${p.id}">${p.name} (Stok: ${p.stock})</option>`;
                
                tbody.innerHTML += `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="p-6">
                            <div class="font-black text-slate-800 uppercase tracking-tighter">${p.name}</div>
                            <div class="text-[9px] font-bold text-slate-400 uppercase">${p.stock < 5 ? 'Status: Kritis' : 'Status: Aman'}</div>
                        </td>
                        <td class="p-6 font-bold text-slate-500">${formatR(p.price)}</td>
                        <td class="p-6">
                            <span class="text-xl font-black ${p.stock < 5 ? 'text-red-500' : 'text-slate-900'}">${p.stock}</span>
                            <span class="text-[10px] text-gray-400 font-bold uppercase ml-1">Pcs</span>
                        </td>
                        <td class="p-6">
                            <div class="flex justify-center space-x-2">
                                <button onclick='openEditModal(${JSON.stringify(p)})' class="w-9 h-9 rounded-xl bg-white border border-gray-100 text-slate-300 hover:text-blue-600 transition shadow-sm flex items-center justify-center">
                                    <i class="fas fa-edit text-xs"></i>
                                </button>
                                <button onclick="deletePart(${p.id}, '${p.name}')" class="w-9 h-9 rounded-xl bg-white border border-gray-100 text-slate-300 hover:text-red-600 transition shadow-sm flex items-center justify-center">
                                    <i class="fas fa-trash-alt text-xs"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
        }

        // FUNGSI MODIFIKASI
        function openEditModal(p) {
            document.getElementById('edit-p-id').value = p.id;
            document.getElementById('edit-p-name').value = p.name;
            document.getElementById('edit-p-price').value = p.price;
            document.getElementById('edit-p-stock').value = p.stock;
            document.getElementById('editPartModal').classList.remove('hidden');
        }

        function closeEditModal() { document.getElementById('editPartModal').classList.add('hidden'); }

        async function savePartUpdate() {
            const id = document.getElementById('edit-p-id').value;
            const data = {
                name: document.getElementById('edit-p-name').value,
                price: document.getElementById('edit-p-price').value,
                stock: document.getElementById('edit-p-stock').value
            };

            const res = await fetch(`/api/parts/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (res.ok) { closeEditModal(); loadInventory(); }
        }

        // FUNGSI HAPUS
        async function deletePart(id, name) {
            if (confirm(`Hapus barang ${name} dari gudang permanen?`)) {
                const res = await fetch(`/api/parts/${id}`, { method: 'DELETE' });
                if (res.ok) loadInventory();
            }
        }

        window.onload = loadInventory;
    </script>
</body>
</html>